<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Psycho-Engine Speedtest (HOLO Merge)</title>

  <link href="vendor/fonts/google-fonts.css" rel="stylesheet"/>
  <script src="vendor/tailwind/tailwind.min.js"></script>

  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#0db9f2",
            "secondary": "#a855f7",
            "background-dark": "#050a0c",
            "panel": "#111c21",
            "ethereal-blue": "#00d4ff",
            "cyber-violet": "#9d50bb",
            "void-black": "#020408",
            "engine-iron": "#1a1c23",
            "danger": "#ff3c00",
          },
          fontFamily: {
            "display": ["Space Grotesk", "sans-serif"],
            "mono": ["JetBrains Mono", "monospace"],
          },
          borderRadius: {
            "DEFAULT": "0.125rem",
            "lg": "0.25rem",
            "xl": "0.5rem",
            "full": "0.75rem"
          },
        },
      },
    };
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .vhs-overlay {
        background:
          linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.18) 50%),
          linear-gradient(90deg, rgba(255,0,0,0.055), rgba(0,255,0,0.02), rgba(0,0,255,0.055));
        background-size: 100% 4px, 3px 100%;
        pointer-events: none;
      }
      .chromatic-aberration {
        text-shadow: 1.5px 0 0 rgba(255,0,0,0.38), -1.5px 0 0 rgba(0,255,255,0.38);
      }
      .glitch-border {
        box-shadow:
          0 0 14px rgba(0,212,255,0.20),
          0 0 30px rgba(157,80,187,0.12),
          inset 0 0 14px rgba(0,212,255,0.10);
      }
      .glass-ring {
        border: 2px solid rgba(0, 212, 255, 0.14);
        box-shadow:
          inset 0 0 20px rgba(0, 212, 255, 0.09),
          0 0 18px rgba(157, 80, 187, 0.16);
      }
      .nitro-shard {
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
      }
      .engine-frame {
        background: linear-gradient(145deg, #1a1c23, #020408);
        border: 1px solid rgba(255,255,255,0.05);
        box-shadow: 10px 10px 22px #010204, -5px -5px 15px rgba(255,255,255,0.02);
      }
      .neural-node {
        background: radial-gradient(circle, rgba(0, 212, 255, 0.30) 0%, transparent 70%);
      }
      .perspective-center { perspective: 1200px; }
      .rotate-x-25 { transform: rotateX(25deg); }
      .data-heart-glow { filter: drop-shadow(0 0 15px rgba(0,212,255,0.55)); }
      .soft-frost {
        background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
        backdrop-filter: blur(18px);
      }
      .scanline-mask {
        background-image: repeating-linear-gradient(
          0deg,
          rgba(255,255,255,0.00),
          rgba(255,255,255,0.00) 2px,
          rgba(0,212,255,0.08) 2px,
          rgba(0,212,255,0.08) 3px
        );
        mix-blend-mode: overlay;
      }
      .tap-glow:active { filter: drop-shadow(0 0 12px rgba(0,212,255,0.45)); }
      .tap-glow-low:active { filter: drop-shadow(0 0 6px rgba(0,212,255,0.25)); }
      .header-video-frame {
        background: linear-gradient(180deg, rgba(2,4,8,0.95), rgba(2,4,8,0.70), rgba(2,4,8,0.35), transparent);
        border-bottom: 1px solid rgba(255,255,255,0.06);
        box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      }
    }
  </style>

  <style>
    body { min-height: max(884px, 100dvh); }

    @keyframes holoPulse {
      0%, 100% { transform: scale(1); filter: blur(28px); opacity: .28; }
      50% { transform: scale(1.06); filter: blur(34px); opacity: .38; }
    }
    @keyframes drift {
      0% { transform: translate3d(0,0,0); opacity: .35; }
      50% { transform: translate3d(10px,-8px,0); opacity: .55; }
      100% { transform: translate3d(0,0,0); opacity: .35; }
    }
    @keyframes jitter {
      0% { transform: translate3d(0,0,0); }
      15% { transform: translate3d(0.8px,-0.4px,0); }
      30% { transform: translate3d(-0.6px,0.6px,0); }
      45% { transform: translate3d(0.7px,0.2px,0); }
      60% { transform: translate3d(-0.4px,-0.5px,0); }
      75% { transform: translate3d(0.5px,0.6px,0); }
      100% { transform: translate3d(0,0,0); }
    }

    /* Cyber button set (replaced with clipped cyber buttons) */

/* Cyberpunk clipped-glitch buttons (from attached style.css), adapted to this layout */
.cybr-btn {
  --primary: hsl(var(--primary-hue), 85%, calc(var(--primary-lightness, 50) * 1%));
  --shadow-primary: hsl(var(--shadow-primary-hue), 90%, 50%);
  --primary-hue: 180;
  --primary-lightness: 50;
  --color: hsl(0, 0%, 0%);
  --font-size: 14px;
  --shadow-primary-hue: 300;
  --shadow-secondary-hue: 60;
  --shadow-secondary: hsl(var(--shadow-secondary-hue), 90%, 60%);
  --clip: polygon(0 0, 100% 0, 100% 100%, 85% 100%, 8% 100%, 0 70%);
  --border: 4px;
  --shimmy-distance: 5;
  --clip-one: polygon(0 2%, 100% 2%, 100% 95%, 8% 95%, 0 70%);
  --clip-two: polygon(0 78%, 100% 78%, 100% 100%, 8% 100%, 0 78%);
  --clip-three: polygon(0 44%, 100% 44%, 100% 54%, 8% 54%, 0 54%);
  --clip-four: polygon(0 0, 100% 0, 100% 0, 8% 0, 0 0);
  --clip-five: polygon(0 0, 100% 0, 100% 0, 8% 0, 0 0);
  --clip-six: polygon(0 40%, 100% 40%, 100% 85%, 8% 85%, 0 70%);
  --clip-seven: polygon(0 63%, 100% 63%, 100% 80%, 8% 80%, 0 70%);

  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;

  width: 100%;
  height: 56px; /* keep existing size */
  padding: 0 16px;

  font-family: "Space Grotesk", sans-serif;
  font-style: italic; /* match the top header vibe */
  font-weight: 900;
  letter-spacing: 0.22em;
  text-transform: uppercase;
  font-size: var(--font-size);

  border: 0;
  outline: transparent;
  cursor: pointer;

  color: var(--color);
  background: transparent;
  transition: filter 0.2s, transform 0.12s;
  clip-path: var(--clip);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

.cybr-btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
  filter: saturate(0.7);
}

.cybr-btn:active:not(:disabled) {
  transform: scale(0.985);
  filter: brightness(0.95);
}

.cybr-btn:before,
.cybr-btn:after {
  content: "";
  position: absolute;
  inset: 0;
  clip-path: var(--clip);
  z-index: -1;
}

.cybr-btn:before {
  background: var(--shadow-primary);
  transform: translate(var(--border), 0);
}

.cybr-btn:after {
  background: var(--primary);
}

.cybr-btn__glitch {
  position: absolute;
  top: calc(var(--border) * -1);
  left: calc(var(--border) * -1);
  right: calc(var(--border) * -1);
  bottom: calc(var(--border) * -1);
  background: var(--shadow-primary);
  text-shadow: 2px 2px var(--shadow-primary), -2px -2px var(--shadow-secondary);
  clip-path: var(--clip);
  animation: glitch 2s infinite;
  display: none;
  align-items: center;
  justify-content: center;
  font-family: "Space Grotesk", sans-serif;
  font-style: italic;
  font-weight: 900;
  letter-spacing: 0.22em;
  text-transform: uppercase;
  color: var(--color);
}

.cybr-btn:hover:not(:disabled) .cybr-btn__glitch {
  display: inline-flex;
}

.cybr-btn__glitch:before {
  content: "";
  position: absolute;
  inset: var(--border);
  clip-path: var(--clip);
  background: var(--primary);
  z-index: -1;
}

@keyframes glitch {
  0% { clip-path: var(--clip-one); }
  2%, 8% { clip-path: var(--clip-two); transform: translate(calc(var(--shimmy-distance) * -1%), 0); }
  6% { clip-path: var(--clip-two); transform: translate(calc(var(--shimmy-distance) * 1%), 0); }
  9% { clip-path: var(--clip-two); transform: translate(0, 0); }
  10% { clip-path: var(--clip-three); transform: translate(calc(var(--shimmy-distance) * 1%), 0); }
  13% { clip-path: var(--clip-three); transform: translate(0, 0); }
  14%, 21% { clip-path: var(--clip-four); transform: translate(calc(var(--shimmy-distance) * 1%), 0); }
  25% { clip-path: var(--clip-five); transform: translate(calc(var(--shimmy-distance) * 1%), 0); }
  30% { clip-path: var(--clip-five); transform: translate(calc(var(--shimmy-distance) * -1%), 0); }
  35%, 45% { clip-path: var(--clip-six); transform: translate(calc(var(--shimmy-distance) * -1%)); }
  40% { clip-path: var(--clip-six); transform: translate(calc(var(--shimmy-distance) * 1%)); }
  50% { clip-path: var(--clip-six); transform: translate(0, 0); }
  55% { clip-path: var(--clip-seven); transform: translate(calc(var(--shimmy-distance) * 1%), 0); }
  60% { clip-path: var(--clip-seven); transform: translate(0, 0); }
  31%, 61%, 100% { clip-path: var(--clip-four); }
}

/* Color variants: green engage, pink abort, violet reset */
.cybr-green { --primary-hue: 135; --shadow-primary-hue: 150; --shadow-secondary-hue: 60; --primary-lightness: 58; }
.cybr-pink  { --primary-hue: 315; --shadow-primary-hue: 320; --shadow-secondary-hue: 180; --primary-lightness: 60; }
.cybr-violet{ --primary-hue: 275; --shadow-primary-hue: 285; --shadow-secondary-hue: 180; --primary-lightness: 58; }

@media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
    }
    /* === Config screen controls styling === */
    .toggle {
      -webkit-appearance: none;
      appearance: none;
      width: 3rem;
      height: 1.4rem;
      background-color: rgba(255,255,255,0.05);
      border: 1px solid var(--toggle-border, #00d4ff);
      border-radius: 9999px;
      position: relative;
      cursor: pointer;
      outline: none;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .toggle::after {
      content: "";
      position: absolute;
      top: 0.1rem;
      left: 0.1rem;
      width: 1.2rem;
      height: 1.2rem;
      background-color: var(--toggle-knob, #00d4ff);
      border-radius: 9999px;
      transition: transform 0.3s, background-color 0.3s;
      box-shadow: 0 0 6px var(--toggle-knob, #00d4ff);
    }
    .toggle:checked {
      background-color: rgba(157,80,187,0.3);
      border-color: #9d50bb;
    }
    .toggle:checked::after {
      transform: translateX(1.6rem);
      background-color: #9d50bb;
      box-shadow: 0 0 6px #9d50bb;
    }
    /* Range slider styling */
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      background: transparent;
    }
    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px;
      background: rgba(0,212,255,0.3);
      border-radius: 2px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #00d4ff;
      border-radius: 50%;
      margin-top: -5px;
      box-shadow: 0 0 6px #00d4ff;
    }
    input[type="range"]::-moz-range-track {
      height: 4px;
      background: rgba(0,212,255,0.3);
      border-radius: 2px;
    }
    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      background: #00d4ff;
      border-radius: 50%;
      border: none;
      box-shadow: 0 0 6px #00d4ff;
    }
    /* Neon button style */
    .btn-neon {
      position: relative;
      padding: 0.6rem 1.2rem;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: 2px solid currentColor;
      border-radius: 0.375rem;
      color: var(--btn-color, #00d4ff);
      background: transparent;
      overflow: hidden;
      transition: color 0.3s;
    }
    .btn-neon::before {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--btn-glow, rgba(0,212,255,0.3));
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
      filter: blur(8px);
    }
    .btn-neon:hover {
      color: #000;
    }
    .btn-neon:hover::before {
      opacity: 1;
    }

    /* Additional animations and holographic device styles */
    /* Rotate animations for spinning rings around the WiFi symbol */
    @keyframes revolve {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes revolve-reverse {
      from { transform: rotate(360deg); }
      to { transform: rotate(0deg); }
    }
    .spin-slow {
      animation: revolve 30s linear infinite;
    }
    .spin-slower {
      animation: revolve-reverse 50s linear infinite;
    }
    /* Electrify effect for icons */
    @keyframes electrify {
      0%, 100% {
        filter: drop-shadow(0 0 2px var(--glow-color)) brightness(1);
      }
      50% {
        filter: drop-shadow(0 0 8px var(--glow-color)) brightness(1.4);
      }
    }
    .electrify {
      animation: electrify 2s infinite;
    }
    /* Device card styles */
    .shard-card {
      background: rgba(10, 20, 30, 0.6);
      backdrop-filter: blur(8px);
      border-left: 1px solid rgba(255, 255, 255, 0.3);
      border-top: 1px solid rgba(255, 255, 255, 0.3);
      border-right: 1px solid rgba(0, 0, 0, 0.5);
      border-bottom: 1px solid rgba(0, 0, 0, 0.5);
      transform: perspective(800px) rotateY(-5deg) rotateX(5deg);
      transform-style: preserve-3d;
      box-shadow: 15px 15px 30px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(0, 255, 157, 0.05);
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      position: relative;
      overflow: hidden;
      clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
    }
    .shard-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 40%, transparent 60%, rgba(0, 0, 0, 0.4) 100%);
      z-index: -1;
      pointer-events: none;
    }
    .shard-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 2px;
      padding: 2px;
      background: linear-gradient(45deg, transparent, var(--edge-color, #00ff9d), transparent);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.8;
      pointer-events: none;
    }
    .shard-card:hover {
      transform: perspective(800px) rotateY(0deg) rotateX(0deg) scale(1.02);
      box-shadow: 0 0 20px var(--glow-color, rgba(0, 255, 157, 0.3)), 0 0 40px var(--glow-color, rgba(0, 255, 157, 0.1));
      z-index: 10;
    }
    .liquid-bar-container {
      background: rgba(0, 0, 0, 0.8);
      border-radius: 4px;
      box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.8), inset -1px -1px 2px rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .liquid-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--bar-start) 0%, var(--bar-mid) 50%, var(--bar-end) 100%);
      position: relative;
      box-shadow: 0 0 10px var(--bar-mid);
    }
    .liquid-bar-fill::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.4), transparent);
    }
    .model-cube {
      width: 40px;
      height: 40px;
      position: relative;
      transform-style: preserve-3d;
      animation: cube-spin 8s linear infinite;
    }
    .cube-face {
      position: absolute;
      width: 40px;
      height: 40px;
      border: 1px solid var(--model-color);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cube-face.front { transform: rotateY(0deg) translateZ(20px); }
    .cube-face.back { transform: rotateY(180deg) translateZ(20px); }
    .cube-face.right { transform: rotateY(90deg) translateZ(20px); }
    .cube-face.left { transform: rotateY(-90deg) translateZ(20px); }
    .cube-face.top { transform: rotateX(90deg) translateZ(20px); }
    .cube-face.bottom { transform: rotateX(-90deg) translateZ(20px); }
    @keyframes cube-spin {
      0% { transform: rotateX(-15deg) rotateY(0deg); }
      100% { transform: rotateX(-15deg) rotateY(360deg); }
    }
    .shadow-neon { box-shadow: 0 0 5px #00ff9d, 0 0 15px #00ff9d; }
    .shadow-neon-cyan { box-shadow: 0 0 5px #00f3ff, 0 0 15px #00f3ff; }
    .shadow-neon-orange { box-shadow: 0 0 10px #ffaa00, 0 0 25px #ffaa00; }
    .shadow-purple { box-shadow: 0 0 10px #a855f7, 0 0 20px #a855f7; }

    /* Additional HUD classes from Wifi_map for map screen */
    .glitch-text {
      text-shadow: 2px 0 #00d4ff, -2px 0 #9d50bb;
      letter-spacing: -0.05em;
    }
    .shard-clip {
      clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
    }
    .shard-clip-alt {
      clip-path: polygon(0 15%, 95% 0, 100% 85%, 5% 100%);
    }
    .radar-ring {
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 50%;
      position: absolute;
    }
    .lightning-line {
      background: linear-gradient(90deg, transparent, #00d4ff, transparent);
      height: 1px;
      filter: blur(1px);
    }
    /* Wireframe and digital rain overlays used in the WiFi map screen */
    .wireframe-bg {
      background-image:
        linear-gradient(to right, rgba(0, 212, 255, 0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0, 212, 255, 0.05) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .digital-rain-overlay {
      background: linear-gradient(180deg, rgba(0,212,255,0) 0%, rgba(0,212,255,0.05) 50%, rgba(0,212,255,0) 100%);
      background-size: 100% 200%;
    }
    /* Triangular shard clipping used for the overdrive/cloak buttons from wifi_map */
    .shard-clip {
      clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
    }
    .shard-clip-alt {
      clip-path: polygon(0 15%, 95% 0, 100% 85%, 5% 100%);
    }
    /* Conic gradient used for the engine gauge to restore the missing blue and red arcs. The mask ensures the center remains transparent. */
    .gauge-conic {
      background: conic-gradient(from 225deg, transparent 0deg, #00d4ff 40deg, #00d4ff 180deg, #ff3c00 240deg, transparent 270deg);
      mask: radial-gradient(transparent 65%, black 66%);
      -webkit-mask: radial-gradient(transparent 65%, black 66%);
    }
    /* Neon glow for WiFi list cards and headings */
    .neon-glow {
      text-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
    }
    /* Slight flicker effect for bars in the WiFi list */
    .flicker {
      opacity: 0.8;
    }
    /* Frosted glass panel effect used in WiFi list overlays and cards */
    .glass-panel {
      background: rgba(0, 212, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 212, 255, 0.2);
    }
  </style>
</head>

<body class="bg-void-black font-display text-slate-100 overflow-y-auto antialiased">
  <div class="fixed inset-0 vhs-overlay z-50 mix-blend-overlay opacity-30 pointer-events-none"></div>

  <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
    <div class="absolute top-[15%] left-[20%] w-1.5 h-1.5 neural-node rounded-full blur-[2px] opacity-40" style="animation: drift 7s ease-in-out infinite;"></div>
    <div class="absolute top-[40%] right-[10%] w-1 h-1 neural-node rounded-full blur-[1px] opacity-60" style="animation: drift 9s ease-in-out infinite;"></div>
    <div class="absolute bottom-[30%] left-[15%] w-2 h-2 neural-node rounded-full blur-[3px] opacity-30" style="animation: drift 11s ease-in-out infinite;"></div>
    <div class="absolute top-[70%] right-[30%] w-1 h-1 neural-node rounded-full blur-[1px] opacity-50" style="animation: drift 8s ease-in-out infinite;"></div>
    <div class="absolute top-[25%] right-[45%] w-1.5 h-1.5 neural-node rounded-full blur-[2px] opacity-35" style="animation: drift 10s ease-in-out infinite;"></div>
    <div class="absolute bottom-[18%] right-[18%] w-2 h-2 neural-node rounded-full blur-[3px] opacity-22" style="animation: drift 12s ease-in-out infinite;"></div>
    <div class="absolute top-[58%] left-[8%] w-1 h-1 neural-node rounded-full blur-[1px] opacity-55" style="animation: drift 6s ease-in-out infinite;"></div>

    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(0,212,255,0.08)_0%,rgba(2,4,8,0.00)_55%,rgba(2,4,8,0.90)_78%)]"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-void-black to-void-black"></div>
  </div>

  <!-- WiFi List screen -->
  <section id="wifiListScreen" class="hidden relative flex min-h-[100dvh] w-full flex-col items-center bg-void-black text-slate-100 overflow-y-auto">
    <!-- Header -->
    <div class="w-full border-b border-ethereal-blue/10 bg-void-black/80 backdrop-blur-md p-4 sm:p-6 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-ethereal-blue text-xl sm:text-2xl">wifi</span>
        <div class="flex flex-col">
          <span class="text-ethereal-blue/60 text-[10px] sm:text-[10px] font-bold tracking-[0.3em] uppercase italic" style="color:#faff00;">Device Matrix</span>
          <h2 class="text-slate-100 text-sm sm:text-lg font-bold leading-tight tracking-tight italic" style="color:#ff00ff;">Neural Device Scanner</h2>
        </div>
      </div>
      <button class="tap-glow size-9 rounded-full bg-ethereal-blue/10 border border-ethereal-blue/30 flex items-center justify-center text-ethereal-blue" type="button">
        <span class="material-symbols-outlined">memory</span>
      </button>
    </div>
    <h4 class="text-ethereal-blue/60 text-[9px] sm:text-[10px] font-bold leading-normal tracking-[0.3em] px-4 py-2 text-center uppercase italic" style="color:#faff00;">Device Matrix Online</h4>
    <!-- Central Hologram -->
    <div class="relative w-full flex justify-center p-4">
      <div class="relative w-64 h-64 sm:w-72 sm:h-72 flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(circle, #00d4ff 1px, transparent 1px); background-size: 20px 20px;"></div>
        <div class="absolute inset-0 bg-ethereal-blue/10 rounded-full blur-3xl animate-pulse"></div>
        <div class="relative z-10 flex items-center justify-center">
          <!-- Use a WiFi icon combined with a bolt icon to simulate electrified lightning. Both icons animate using the electrify effect. -->
          <span class="material-symbols-outlined text-6xl sm:text-7xl electrify" style="color:#faff00; --glow-color:#faff00; z-index:1;">wifi_tethering</span>
          <!-- Bolt overlay enlarged to sit within the Wiâ€‘Fi arcs -->
          <span class="material-symbols-outlined absolute inset-0 flex items-center justify-center text-6xl sm:text-7xl electrify pointer-events-none" style="color:#ff00ff; --glow-color:#ff00ff; z-index:2;">bolt</span>
        </div>
        <!-- Spinning Neon Square Frames -->
        <!-- Outer square frame uses the same slow spin animation as the engine gauge and is colored neon yellow -->
        <div class="absolute inset-0 border border-yellow-400 border-dashed spin-slow opacity-70" style="border-color:#faff00;"></div>
        <!-- Inner square frame inset to provide depth and rotates in the opposite direction for a parallax effect -->
        <div class="absolute inset-[10%] border border-yellow-400 border-dashed spin-slower opacity-40" style="border-color:#faff00;"></div>
      </div>
      <!-- Overlay Data -->
      <div class="absolute top-6 left-4 glass-panel p-2 rounded text-[9px] sm:text-[10px] text-ethereal-blue/80 font-mono italic">
        LAT: 37.7749<br/>LNG: -122.4194
      </div>
      <div class="absolute bottom-4 right-4 glass-panel p-2 rounded text-[9px] sm:text-[10px] text-ethereal-blue font-mono flicker">
        PACKETS: 1.2k/s<br/>DROPPED: 0.02%
      </div>
    </div>
    <!-- Scan header -->
    <div class="w-full px-4 py-3 flex flex-col gap-3 border-b border-ethereal-blue/20">
      <div class="flex items-end justify-between gap-4">
        <div class="flex flex-col">
          <h3 class="text-ethereal-blue text-xs sm:text-sm font-bold leading-tight tracking-[0.1em] uppercase italic">Nearby_SSIDs_Scan</h3>
          <span id="wifiScanMeta" class="text-ethereal-blue/40 text-[9px] sm:text-[10px] font-mono">Demo feed armed</span>
        </div>
        <div class="flex flex-wrap justify-end gap-2">
          <button id="wifiScanBtn" class="btn-neon" style="--btn-color:#00d4ff; --btn-glow:rgba(0,212,255,0.3)">Scan</button>
          <button id="wifiDemoBtn" class="btn-neon" style="--btn-color:#a855f7; --btn-glow:rgba(168,85,247,0.3)">Demo</button>
          <button id="wifiExportBtn" class="btn-neon" style="--btn-color:#faff00; --btn-glow:rgba(250,255,0,0.3)">Export</button>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
        <div class="soft-frost border border-ethereal-blue/20 rounded-lg px-3 py-2">
          <div class="text-[9px] uppercase tracking-[0.3em] text-ethereal-blue/60 font-mono">Bridge</div>
          <div id="wifiBridgeState" class="text-xs font-bold text-ethereal-blue mt-1">Offline</div>
        </div>
        <div class="soft-frost border border-ethereal-blue/20 rounded-lg px-3 py-2">
          <div class="text-[9px] uppercase tracking-[0.3em] text-ethereal-blue/60 font-mono">Permissions</div>
          <div id="wifiPermissionState" class="text-xs font-bold text-ethereal-blue mt-1">Tap Scan To Grant</div>
        </div>
        <div class="soft-frost border border-ethereal-blue/20 rounded-lg px-3 py-2">
          <div class="text-[9px] uppercase tracking-[0.3em] text-ethereal-blue/60 font-mono">Scanner</div>
          <div id="wifiScanState" class="text-xs font-bold text-ethereal-blue mt-1">Standby</div>
        </div>
      </div>
    </div>
    <div id="wifiEmptyState" class="w-full px-4 pt-5 text-center text-[11px] tracking-[0.2em] uppercase text-ethereal-blue/50 font-mono">No networks loaded. Use Scan for live data or Demo for fallback.</div>
    <div id="wifiDeviceList" class="flex flex-col w-full px-4 py-4 gap-4 overflow-y-auto"></div>
  </section>

  <!-- Configuration Screen -->
  <section id="configScreen" class="hidden relative flex min-h-[100dvh] w-full flex-col bg-void-black text-slate-100 overflow-y-auto">
    <!-- Config header -->
    <div class="w-full border-b border-ethereal-blue/10 bg-void-black/80 backdrop-blur-md p-4 sm:p-6 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-ethereal-blue text-xl sm:text-2xl">settings</span>
        <h2 class="text-ethereal-blue text-sm sm:text-lg font-bold leading-tight tracking-tight italic">System Configuration</h2>
      </div>
    </div>
    <div class="w-full max-w-md mx-auto px-4 sm:px-6 py-6 flex flex-col space-y-6">
      <!-- Toggle settings -->
      <div class="space-y-4">
        <label class="flex items-center justify-between">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Auto Scan</span>
          <input id="cfgAutoScan" type="checkbox" class="toggle" />
        </label>
        <label class="flex items-center justify-between">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Holo FX</span>
          <input id="cfgHoloFX" type="checkbox" class="toggle" />
        </label>
        <label class="flex items-center justify-between">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Alerts</span>
          <input id="cfgAlerts" type="checkbox" class="toggle" />
        </label>
        <label class="flex items-center justify-between">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Demo Mode</span>
          <input id="cfgDemoMode" type="checkbox" class="toggle" />
        </label>
        <label class="flex items-center justify-between">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Native Bridge</span>
          <input id="cfgBridgeEnabled" type="checkbox" class="toggle" />
        </label>
      </div>
      <!-- Slider settings -->
      <div class="space-y-4">
        <label class="flex flex-col gap-1">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Neon Intensity</span>
          <input id="cfgNeonIntensity" type="range" min="0" max="100" value="70" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm text-ethereal-blue font-mono uppercase">Scan Speed</span>
          <input id="cfgScanSpeed" type="range" min="0" max="100" value="50" />
        </label>
      </div>
      <!-- Accent mode selector -->
      <div class="flex flex-col gap-1">
        <span class="text-sm text-ethereal-blue font-mono uppercase">Accent Mode</span>
        <select id="cfgAccentMode" class="bg-void-black border border-ethereal-blue/30 text-ethereal-blue text-sm p-2 rounded focus:outline-none">
          <option value="blue">Blue</option>
          <option value="violet">Violet</option>
          <option value="pink">Pink</option>
          <option value="green">Green</option>
        </select>
      </div>
      <!-- Performance mode selector -->
      <div class="flex flex-col gap-1">
        <span class="text-sm text-ethereal-blue font-mono uppercase">Performance Mode</span>
        <select id="cfgPerfMode" class="bg-void-black border border-ethereal-blue/30 text-ethereal-blue text-sm p-2 rounded focus:outline-none">
          <option value="high">High FX</option>
          <option value="low">Low FX</option>
        </select>
      </div>
      <!-- Buttons -->
      <div class="flex justify-start gap-4 pt-4">
        <button id="cfgSaveBtn" class="btn-neon" style="--btn-color:#00d4ff; --btn-glow:rgba(0,212,255,0.3)">Save</button>
        <button id="cfgResetBtn" class="btn-neon" style="--btn-color:#ff3c00; --btn-glow:rgba(255,60,0,0.3)">Reset</button>
      </div>
      <div class="space-y-3 border border-ethereal-blue/20 rounded-lg p-4 soft-frost">
        <div>
          <div class="text-[10px] uppercase tracking-[0.3em] text-ethereal-blue/60 font-mono">Bridge State</div>
          <div id="cfgBridgeSummary" class="text-sm text-ethereal-blue mt-1">Checking native layer...</div>
        </div>
        <div>
          <div class="text-[10px] uppercase tracking-[0.3em] text-ethereal-blue/60 font-mono">Device Info</div>
          <div id="cfgDeviceSummary" class="text-sm text-slate-300 mt-1">No device snapshot yet.</div>
        </div>
        <div class="flex flex-wrap gap-3 pt-1">
          <button id="cfgRefreshDeviceBtn" class="btn-neon" style="--btn-color:#00ff9d; --btn-glow:rgba(0,255,157,0.3)">Refresh Device</button>
          <button id="cfgExportDiagBtn" class="btn-neon" style="--btn-color:#faff00; --btn-glow:rgba(250,255,0,0.3)">Export Diag</button>
        </div>
      </div>
      <p id="cfgStatusMsg" class="text-[10px] text-cyber-violet uppercase mt-2 hidden">Settings saved.</p>
    </div>
  </section>


  <!-- WiFi Map Screen -->
  <section id="wifiMapScreen" class="hidden relative flex min-h-[100dvh] w-full flex-col bg-void-black text-slate-100 overflow-hidden">
    <!-- Map header -->
    <div class="w-full flex items-center justify-between p-4 sm:p-6 border-b border-ethereal-blue/10 bg-void-black/80 backdrop-blur-md">
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-ethereal-blue text-xl sm:text-2xl">public</span>
        <h2 class="text-ethereal-blue text-sm sm:text-lg font-bold leading-tight tracking-tight italic glitch-text">*</h2>
        <h2 class="text-ethereal-blue text-sm sm:text-lg font-bold leading-tight tracking-tight italic glitch-text">LOCAL_NET_CONSTELLATION</h2>
      </div>
      <div class="flex items-center gap-4">
        <div class="flex flex-col items-end">
          <span class="text-[9px] text-ethereal-blue/50 uppercase">Sys_Load</span>
          <div class="h-1 w-16 bg-engine-iron rounded-full overflow-hidden">
            <div class="h-full bg-ethereal-blue w-2/3"></div>
          </div>
        </div>
        <button class="tap-glow size-9 rounded-full bg-ethereal-blue/10 border border-ethereal-blue/30 flex items-center justify-center text-ethereal-blue" type="button">
          <span class="material-symbols-outlined">computer</span>
        </button>
      </div>
    </div>
    <!-- Map inner area -->
    <div class="relative flex-1 flex flex-col overflow-hidden">
      <!-- Wireframe and rain effects -->
      <div class="absolute inset-0 wireframe-bg opacity-40 pointer-events-none"></div>
      <div class="absolute inset-0 digital-rain-overlay pointer-events-none"></div>
      <!-- Title and protocol -->
      <div class="p-4 pt-6 z-10">
        <p class="text-primary italic text-xl sm:text-2xl font-bold leading-tight tracking-tighter uppercase glitch-text">
          *LOCAL_NET_CONSTELLATION*
        </p>
        <p class="text-[9px] text-ethereal-blue/40 font-mono mt-1 tracking-widest uppercase">
          Protocol: Shadowlink_v9 // Active_Nodes: 42
        </p>
      </div>
      <!-- Map interactive area -->
      <div class="flex-1 relative">
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="relative w-full h-full p-4">
            <!-- Map container -->
            <div class="w-full h-full rounded-lg border border-ethereal-blue/10 bg-black/40 relative overflow-hidden flex items-center justify-center">
              <!-- Top-left control icons -->
              <div class="absolute top-4 left-4 z-20 flex flex-col gap-2 bg-engine-iron/90 border border-ethereal-blue/30 p-2 rounded">
                <span class="material-symbols-outlined text-ethereal-blue text-sm">filter_center_focus</span>
                <span class="material-symbols-outlined text-ethereal-blue text-sm">layers</span>
              </div>
              <!-- Central radar -->
              <div class="relative w-full h-full flex items-center justify-center">
                <svg class="absolute inset-0 w-full h-full" viewBox="0 0 400 400">
                  <path d="M100 100 L200 150 L300 100 L250 250 L100 100" fill="none" stroke="#00d4ff" stroke-dasharray="4 2" stroke-width="0.5"></path>
                  <path d="M200 150 L150 300 L250 250" fill="none" stroke="#00d4ff" stroke-dasharray="4 2" stroke-width="0.5"></path>
                </svg>
                <!-- Node markers with pulses -->
                <div class="absolute top-1/4 left-1/4 flex flex-col items-center">
                  <div class="size-4 rounded-full bg-ethereal-blue shadow-[0_0_10px_#00d4ff] animate-pulse"></div>
                  <div class="absolute -inset-2 border border-cyber-violet rounded-full opacity-60"></div>
                  <span class="text-[8px] mt-4 text-ethereal-blue bg-black/80 px-1 uppercase">NODE_01_SEC_L1</span>
                </div>
                <div class="absolute top-1/3 right-1/4 flex flex-col items-center">
                  <div class="size-3 rounded-full bg-ethereal-blue/60 shadow-[0_0_5px_#00d4ff]"></div>
                  <div class="absolute -inset-3 border-2 border-cyber-violet/80 rounded-full"></div>
                  <span class="text-[8px] mt-4 text-ethereal-blue bg-black/80 px-1 uppercase">NODE_02_SEC_L3</span>
                </div>
                <div class="absolute bottom-1/4 right-1/3 flex flex-col items-center">
                  <div class="size-4 rounded-full bg-ethereal-blue shadow-[0_0_10px_#00d4ff]"></div>
                  <div class="absolute -inset-1.5 border border-cyber-violet/40 rounded-full"></div>
                  <span class="text-[8px] mt-4 text-ethereal-blue bg-black/80 px-1 uppercase">NODE_03_SEC_L2</span>
                </div>
                <!-- Central numeric indicator -->
                <div class="relative w-28 h-28 sm:w-32 sm:h-32 rounded-full border-2 border-ethereal-blue shadow-[0_0_30px_rgba(0,212,255,0.5)] overflow-hidden bg-black/80 flex items-center justify-center">
                  <div class="absolute inset-0 bg-gradient-to-tr from-cyber-violet/30 via-transparent to-ethereal-blue/20"></div>
                  <div id="mapValue" class="text-ethereal-blue text-5xl sm:text-6xl font-black italic opacity-80 glitch-text">0</div>
                  <div class="absolute inset-0 border-[6px] sm:border-[8px] border-ethereal-blue/20 border-dotted rounded-full"></div>
                </div>
              </div>
              <!-- Search & sliders -->
              <div class="absolute bottom-4 left-4 right-4 flex flex-col gap-4">
                <div class="flex items-center gap-3 bg-engine-iron/80 border border-ethereal-blue/30 p-3 rounded">
                  <span class="material-symbols-outlined text-ethereal-blue text-sm">search</span>
                  <input class="bg-transparent border-none text-ethereal-blue placeholder:text-ethereal-blue/40 text-xs focus:ring-0 w-full uppercase" placeholder="SEARCH_NODE_ID..." />
                </div>
                <div class="flex justify-between items-center px-2">
                  <div class="flex flex-col gap-1 w-24">
                    <div class="h-1 bg-ethereal-blue/20 rounded-full relative">
                      <div class="absolute left-1/3 size-3 -top-1 bg-ethereal-blue rounded-full shadow-[0_0_8px_#00d4ff]"></div>
                    </div>
                    <span class="text-[8px] text-ethereal-blue/60 uppercase">Zoom_Lvl</span>
                  </div>
                  <div class="flex flex-col gap-1 w-24">
                    <div class="h-1 bg-ethereal-blue/20 rounded-full relative">
                      <div class="absolute left-2/3 size-3 -top-1 bg-ethereal-blue rounded-full shadow-[0_0_8px_#00d4ff]"></div>
                    </div>
                    <span class="text-[8px] text-ethereal-blue/60 uppercase">Scan_Freq</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Node summary cards -->
      <div class="px-4 py-6 grid grid-cols-2 gap-4">
        <div class="relative group">
          <div class="bg-engine-iron/80 border border-ethereal-blue/30 rounded p-3 aspect-video flex flex-col justify-between overflow-hidden relative">
            <div class="absolute inset-0 opacity-10 bg-ethereal-blue/20"></div>
            <div class="flex justify-between items-start">
              <span class="text-[10px] font-mono text-ethereal-blue uppercase">Node_L1</span>
              <span class="material-symbols-outlined text-xs text-cyber-violet">shield</span>
            </div>
            <p class="text-ethereal-blue text-[11px] font-bold leading-none tracking-tight">NODE_01_SEC_L1</p>
          </div>
        </div>
        <div class="relative group">
          <div class="bg-engine-iron/80 border border-cyber-violet/50 rounded p-3 aspect-video flex flex-col justify-between overflow-hidden relative">
            <div class="absolute inset-0 opacity-10 bg-ethereal-blue/20"></div>
            <div class="flex justify-between items-start">
              <span class="text-[10px] font-mono text-ethereal-blue uppercase">Node_L3</span>
              <span class="material-symbols-outlined text-xs text-cyber-violet">security</span>
            </div>
            <p class="text-ethereal-blue text-[11px] font-bold leading-none tracking-tight">NODE_02_SEC_L3</p>
          </div>
        </div>
      </div>
      <!-- Overdrive and Cloak buttons (adapted from wifi_map.html) -->
      <div class="absolute bottom-32 left-4 flex flex-col gap-3 z-30">
        <!-- Overdrive button -->
        <button class="shard-clip-alt bg-cyber-violet/20 border border-ethereal-blue/30 text-ethereal-blue font-black px-4 py-2 uppercase italic flex items-center gap-1 tap-glow" type="button">
          <span class="material-symbols-outlined text-sm">bolt</span>
          Overdrive
        </button>
        <!-- Cloak button -->
        <button class="shard-clip bg-engine-iron/80 border border-cyber-violet/40 text-ethereal-blue font-black px-4 py-2 uppercase italic flex items-center gap-1 tap-glow" type="button">
          <span class="material-symbols-outlined text-sm">shield_with_heart</span>
          Cloak
        </button>
      </div>
      <!-- Anomaly detection card -->
      <div class="absolute bottom-32 right-4 bg-engine-iron/80 border border-danger/50 p-3 w-44 z-30">
        <div class="flex items-center gap-2 mb-1">
          <div class="size-2 bg-danger rounded-full shadow-[0_0_8px_#ff3c00]"></div>
          <div class="text-[10px] text-danger uppercase font-black">Anomaly Detected</div>
        </div>
        <div class="text-slate-400 font-mono text-[9px] leading-tight">
          FRAC_CORE: UNSTABLE<br/>
          UID: ABYSS_092<br/>
          SIG: MALICIOUS
        </div>
      </div>
    </div>
    <!-- Pulses bottom center -->
    <div class="absolute inset-x-0 bottom-20 h-12 flex justify-center pointer-events-none">
      <div class="w-full max-w-xs h-full flex items-center justify-around">
        <div class="size-1 bg-ethereal-blue/40 rounded-full"></div>
        <div class="size-1.5 bg-ethereal-blue rounded-full shadow-[0_0_5px_#00d4ff]"></div>
        <div class="size-1 bg-ethereal-blue/40 rounded-full"></div>
      </div>
    </div>
  </section>

  <div id="engineScreen" class="relative flex min-h-[100dvh] w-full flex-col justify-between">

    <!-- Header video (speed.mp4) -->
    <div class="relative z-30 w-full header-video-frame">
      <div class="px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4">
        <div class="w-full rounded-xl overflow-hidden border border-white/10 bg-black/50">
          <video
            id="headerVid"
            class="w-full max-h-[140px] sm:max-h-[180px] object-contain bg-black"
            src="speed.mp4"
            autoplay
            muted
            loop
            playsinline
          ></video>
        </div>
      </div>
    </div>

    <header class="relative z-20 flex items-center justify-between p-4 pt-3 sm:p-6 sm:pt-6 bg-gradient-to-b from-void-black/75 to-transparent">
      <div class="flex flex-col">
        <span class="text-[10px] tracking-[0.3em] text-ethereal-blue/70 font-mono uppercase">SYSTEM STATUS</span>
        <h2 class="text-ethereal-blue text-sm sm:text-base font-black leading-tight flex items-center gap-2 italic chromatic-aberration">
          <span class="material-symbols-outlined text-base">terminal</span>
          PSYCHO-ENGINE / HOLO MERGE
        </h2>
      </div>

      <div class="flex gap-4 items-center">
        <div class="text-right hidden sm:block">
          <p class="text-[10px] text-slate-500 uppercase font-mono">Neural Link</p>
          <p class="text-xs font-bold text-cyber-violet font-mono tracking-widest">ENCRYPTED</p>
        </div>

        <button id="btnSettings" class="tap-glow size-10 rounded-full bg-ethereal-blue/10 border border-ethereal-blue/30 flex items-center justify-center text-ethereal-blue" type="button">
          <span class="material-symbols-outlined">settings_input_component</span>
        </button>
      </div>
    </header>

    <main class="relative z-20 flex-1 min-h-0 flex flex-col items-center justify-center px-4 sm:px-6 perspective-center">
      <div class="absolute inset-0 z-0 opacity-20">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_transparent_0%,_#020408_70%)] z-10"></div>
        <div class="w-full h-full bg-center bg-cover scale-110"
             style="background-image:
               radial-gradient(circle at 50% 35%, rgba(0, 212, 255, 0.20), transparent 32%),
               radial-gradient(circle at 50% 55%, rgba(157, 80, 187, 0.18), transparent 38%),
               linear-gradient(135deg, rgba(3, 8, 18, 0.96) 0%, rgba(7, 20, 34, 0.88) 42%, rgba(2, 4, 8, 0.98) 100%);">
        </div>
      </div>

      <div class="relative z-10 flex flex-col items-center w-full max-w-sm sm:max-w-md">

        <div class="absolute -top-12 left-0 right-0 flex justify-between px-6 opacity-90 rotate-x-25" aria-hidden="true">
          <div class="flex flex-col items-start border-l-2 border-ethereal-blue/40 pl-2">
            <span class="text-[9px] text-ethereal-blue uppercase tracking-widest font-mono">Heat Level</span>
            <span id="heatLabel" class="text-sm font-black text-ethereal-blue">IDLE</span>
          </div>
          <div class="flex flex-col items-end border-r-2 border-cyber-violet/40 pr-2">
            <span class="text-[9px] text-cyber-violet uppercase tracking-widest font-mono">Pressure</span>
            <span id="pressureLabel" class="text-sm font-black text-cyber-violet">STABLE</span>
          </div>
        </div>

        <div class="relative group w-full flex items-center justify-center">
          <div id="aura" class="absolute -inset-10 bg-ethereal-blue/10 blur-3xl rounded-full" style="animation: holoPulse 4.5s ease-in-out infinite;"></div>
          <!-- Spinning diamond frame around the gauge -->
          <div class="absolute -inset-6 sm:-inset-8 engine-frame rounded-3xl rotate-45 opacity-45 border-2 border-white/5 animate-[spin_60s_linear_infinite]"></div>

          <div class="relative size-64 sm:size-80 flex items-center justify-center transform-gpu">
            <!-- Outer glow rings spinning at different speeds -->
            <div class="absolute inset-0 rounded-full glass-ring animate-[spin_10s_linear_infinite] opacity-80"></div>
            <div class="absolute inset-4 rounded-full glass-ring opacity-55 animate-[spin_15s_linear_infinite_reverse] border-cyber-violet/20"></div>
            <div class="absolute inset-2 rounded-full border border-ethereal-blue/10 opacity-60 scale-110"></div>

            <!-- Conic gradient arc overlay (restores missing gauge colors) -->
            <!-- Increase opacity to make the blue and red arcs more visible -->
            <div class="absolute inset-0 gauge-conic opacity-60 blur-[2px]"></div>
            <!-- Slow spinning dashed ring overlay -->
            <div class="absolute inset-[-5px] rounded-full border-[2px] border-dashed border-ethereal-blue/30 animate-[spin_30s_linear_infinite] opacity-55"></div>

            <!-- Outer dashed ring -->
            <div class="absolute inset-2 flex items-center justify-center">
              <div class="w-full h-full rounded-full border-[1px] border-dashed border-white/10 opacity-45"></div>
            </div>

            <!-- Tick markers around the gauge for extra detail -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
              <div class="relative w-full h-full">
                <div class="absolute inset-0 flex items-center justify-center rotate-[225deg]"><div class="w-1 h-6 bg-ethereal-blue shadow-[0_0_15px_#00d4ff] -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
                <div class="absolute inset-0 flex items-center justify-center rotate-[270deg]"><div class="w-1 h-4 bg-ethereal-blue/60 -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
                <div class="absolute inset-0 flex items-center justify-center rotate-[315deg]"><div class="w-1.5 h-6 bg-ethereal-blue shadow-[0_0_15px_#00d4ff] -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
                <div class="absolute inset-0 flex items-center justify-center rotate-[0deg]"><div class="w-1 h-4 bg-ethereal-blue/60 -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
                <div class="absolute inset-0 flex items-center justify-center rotate-[45deg]"><div class="w-1.5 h-6 bg-ethereal-blue shadow-[0_0_15px_#00d4ff] -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
                <div class="absolute inset-0 flex items-center justify-center rotate-[90deg]"><div class="w-1.5 h-6 bg-danger shadow-[0_0_20px_#ff3c00] -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
                <div class="absolute inset-0 flex items-center justify-center rotate-[135deg]"><div class="w-2 h-8 bg-danger shadow-[0_0_25px_#ff3c00] -translate-y-[115px] sm:-translate-y-[145px]"></div></div>
              </div>
            </div>

            <!-- Vertical danger bar inside gauge (spins slowly to represent critical range) -->
            <div class="absolute inset-0 flex items-center justify-center rotate-[105deg] z-20 animate-[spin_60s_linear_infinite]">
              <div class="relative h-[320px] w-[3px]">
                <div class="absolute bottom-1/2 left-0 w-full h-[140px] bg-gradient-to-t from-danger to-transparent shadow-[0_0_25px_#ff3c00]"></div>
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-4 h-4 rounded-full bg-white shadow-[0_0_30px_8px_#ff3c00]"></div>
              </div>
            </div>

            <!-- Needle and center pivot -->
            <div class="absolute inset-0 flex items-center justify-center">
              <div id="needlePivot" class="absolute w-full h-full flex items-center justify-center" style="transform: rotate(140deg);">
                <div class="relative w-44 sm:w-52 flex items-center justify-end origin-left">
                  <div class="w-28 sm:w-32 h-[3px] bg-gradient-to-r from-transparent via-ethereal-blue to-white rounded-full shadow-[0_0_20px_#00d4ff]"></div>
                  <div class="absolute -right-1 w-2 h-2 bg-white rounded-full blur-[2px]"></div>
                </div>
                <div class="absolute w-36 h-20 bg-ethereal-blue/5 blur-xl rounded-full -left-12 origin-right"></div>
              </div>
              <div class="absolute w-3.5 h-3.5 rounded-full bg-white/80 blur-[0.5px] shadow-[0_0_18px_rgba(0,212,255,0.35)]"></div>
            </div>

            <div class="relative z-20 size-48 sm:size-56 bg-panel/70 soft-frost rounded-2xl border-2 border-ethereal-blue/35 glitch-border p-4 flex flex-col items-center justify-center overflow-hidden">
              <div class="absolute inset-0 opacity-15 scanline-mask"></div>

              <div class="relative z-10 flex flex-col items-center select-none">
                <span id="phaseLabel" class="text-[10px] tracking-[0.5em] text-ethereal-blue/70 font-mono font-bold mb-1 uppercase italic">IDLE</span>

                <div class="flex items-baseline gap-1 chromatic-aberration">
                  <span id="mainInt" class="text-6xl sm:text-7xl font-black text-white tracking-tighter leading-none">0</span>
                  <span id="mainFrac" class="text-xl font-black text-ethereal-blue">.0</span>
                </div>

                <span id="unitLabel" class="text-lg font-bold text-ethereal-blue/80 tracking-widest mt-2">Mbps</span>

                <div class="mt-3 flex items-center gap-2 font-mono text-[10px] text-white/60">
                  <span class="inline-flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-ethereal-blue shadow-[0_0_8px_#00d4ff]"></span>
                    <span id="statusText">READY</span>
                  </span>
                  <span class="opacity-50">|</span>
                  <span id="timerText" class="tracking-widest">00:00</span>
                </div>
              </div>

              <div class="absolute bottom-0 left-0 right-0 h-16 opacity-25 data-heart-glow">
                <svg class="w-full h-full text-ethereal-blue" viewBox="0 0 200 100" preserveAspectRatio="none">
                  <path id="wavePath" d="M0 100 L20 40 L40 80 L60 20 L80 90 L100 10 L120 70 L140 30 L160 85 L180 45 L200 100 Z" fill="currentColor"></path>
                </svg>
              </div>

              <div id="scanJitter" class="absolute inset-0 pointer-events-none opacity-0"></div>
            </div>

            <div class="absolute -top-4 -right-4 size-12 bg-cyber-violet/20 border border-cyber-violet/50 nitro-shard flex items-center justify-center">
              <span class="material-symbols-outlined text-cyber-violet text-sm">bolt</span>
            </div>
          </div>
        </div>

        <div class="mt-10 sm:mt-12 grid grid-cols-3 gap-3 w-full px-2">
          <div class="bg-engine-iron/55 border-l border-ethereal-blue/40 p-3 rounded-sm">
            <p class="text-[8px] text-slate-500 uppercase font-bold tracking-widest font-mono">Latency</p>
            <p class="text-lg font-black text-slate-100">
              <span id="latencyVal">--</span><span class="text-[10px] text-ethereal-blue ml-1 font-mono">MS</span>
            </p>
          </div>
          <div class="bg-engine-iron/55 border-l border-ethereal-blue/40 p-3 rounded-sm">
            <p class="text-[8px] text-slate-500 uppercase font-bold tracking-widest font-mono">Jitter</p>
            <p class="text-lg font-black text-slate-100">
              <span id="jitterVal">--</span><span class="text-[10px] text-ethereal-blue ml-1 font-mono">MS</span>
            </p>
          </div>
          <div class="bg-engine-iron/55 border-l border-ethereal-blue/40 p-3 rounded-sm">
            <p class="text-[8px] text-slate-500 uppercase font-bold tracking-widest font-mono">Loss</p>
            <p class="text-lg font-black text-slate-100">
              <span id="lossVal">--</span><span class="text-[10px] text-ethereal-blue ml-1 font-mono">%</span>
            </p>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-3 w-full px-2">
          <div class="bg-panel/35 border border-white/5 p-3 rounded-md">
            <p class="text-[9px] text-slate-500 uppercase font-mono tracking-widest">Downlink</p>
            <p class="text-sm font-mono text-white"><span id="downVal">0.0</span> <span class="text-ethereal-blue">Mbps</span></p>
          </div>
          <div class="bg-panel/35 border border-white/5 p-3 rounded-md">
            <p class="text-[9px] text-slate-500 uppercase font-mono tracking-widest">Uplink</p>
            <p class="text-sm font-mono text-white"><span id="upVal">0.0</span> <span class="text-cyber-violet">Mbps</span></p>
          </div>
        </div>

      </div>
    </main>

    <footer class="relative z-30 shrink-0 p-6 pb-10 sm:px-8 sm:pb-12 flex flex-col gap-6">
      
<div class="grid grid-cols-3 gap-3">
        <button id="btnStart" class="cybr-btn cybr-green tap-glow" type="button" aria-label="Engage">
          <span class="cybr-btn__glitch" aria-hidden="true">ENGAGE</span>
          ENGAGE
        </button>

        <button id="btnAbort" class="cybr-btn cybr-pink tap-glow" type="button" aria-label="Abort">
          <span class="cybr-btn__glitch" aria-hidden="true">ABORT</span>
          ABORT
        </button>

        <button id="btnReset" class="cybr-btn cybr-violet tap-glow" type="button" aria-label="Reset">
          <span class="cybr-btn__glitch" aria-hidden="true">RESET</span>
          RESET
        </button>
      </div>

      <!-- bottom nav moved outside engine screen -->

      <div class="absolute bottom-24 left-0 w-full flex justify-center opacity-[0.08] pointer-events-none select-none">
        <span class="text-[96px] sm:text-[120px] font-black tracking-tighter leading-none">OVERDRIVE</span>
      </div>
    </footer>

    <!-- Vertical accent bars for engine screen -->
    <div id="barsLeft" class="absolute top-1/2 left-4 -translate-y-1/2 flex flex-col gap-1 z-0">
      <div class="h-12 w-0.5 bg-ethereal-blue/30"></div>
      <div class="h-2 w-0.5 bg-cyber-violet"></div>
      <div class="h-20 w-0.5 bg-ethereal-blue/10"></div>
    </div>
    <div id="barsRight" class="absolute top-1/2 right-4 -translate-y-1/2 flex flex-col gap-1 z-0 items-end">
      <div class="h-20 w-0.5 bg-ethereal-blue/10"></div>
      <div class="h-2 w-0.5 bg-ethereal-blue"></div>
      <div class="h-12 w-0.5 bg-cyber-violet/30"></div>
    </div>

  </div>


  <!-- Global bottom navigation -->
  <nav id="bottomNav" class="fixed bottom-0 left-0 right-0 z-40 bg-engine-iron/80 backdrop-blur-lg border-t border-ethereal-blue/10 py-2 px-4 flex justify-between items-center">
    <button id="navEngine" class="flex-1 flex flex-col items-center gap-1 text-slate-500 hover:text-ethereal-blue transition-colors" type="button">
      <span class="material-symbols-outlined text-2xl">offline_bolt</span>
      <span class="text-[9px] font-bold tracking-tighter font-mono uppercase">Engine</span>
    </button>
    <button id="navList" class="flex-1 flex flex-col items-center gap-1 text-slate-500 hover:text-ethereal-blue transition-colors" type="button">
      <span class="material-symbols-outlined text-2xl">wifi</span>
      <span class="text-[9px] font-bold tracking-tighter font-mono uppercase">WiFi</span>
    </button>
    <button id="navMap" class="flex-1 flex flex-col items-center gap-1 text-slate-500 hover:text-ethereal-blue transition-colors" type="button">
      <span class="material-symbols-outlined text-2xl">public</span>
      <span class="text-[9px] font-bold tracking-tighter font-mono uppercase">Map</span>
    </button>
    <button id="navConfig" class="flex-1 flex flex-col items-center gap-1 text-slate-500 hover:text-ethereal-blue transition-colors" type="button">
      <span class="material-symbols-outlined text-2xl">settings</span>
      <span class="text-[9px] font-bold tracking-tighter font-mono uppercase">Config</span>
    </button>
  </nav>

  <script>
    (() => {
      const $ = (id) => document.getElementById(id);

      const ui = {
        btnStart: $("btnStart"),
        btnAbort: $("btnAbort"),
        btnReset: $("btnReset"),

        heatLabel: $("heatLabel"),
        pressureLabel: $("pressureLabel"),
        phaseLabel: $("phaseLabel"),
        unitLabel: $("unitLabel"),
        statusText: $("statusText"),
        timerText: $("timerText"),

        mainInt: $("mainInt"),
        mainFrac: $("mainFrac"),

        latencyVal: $("latencyVal"),
        jitterVal: $("jitterVal"),
        lossVal: $("lossVal"),

        downVal: $("downVal"),
        upVal: $("upVal"),

        needlePivot: $("needlePivot"),
        aura: $("aura"),
        scanJitter: $("scanJitter"),
        wavePath: $("wavePath"),
      };

      const nativeUi = {
        wifiDeviceList: $("wifiDeviceList"),
        wifiEmptyState: $("wifiEmptyState"),
        wifiScanMeta: $("wifiScanMeta"),
        wifiBridgeState: $("wifiBridgeState"),
        wifiPermissionState: $("wifiPermissionState"),
        wifiScanState: $("wifiScanState"),
        wifiScanBtn: $("wifiScanBtn"),
        wifiDemoBtn: $("wifiDemoBtn"),
        wifiExportBtn: $("wifiExportBtn"),
        cfgBridgeSummary: $("cfgBridgeSummary"),
        cfgDeviceSummary: $("cfgDeviceSummary"),
        cfgRefreshDeviceBtn: $("cfgRefreshDeviceBtn"),
        cfgExportDiagBtn: $("cfgExportDiagBtn"),
      };

      const State = Object.freeze({
        IDLE: "IDLE",
        PING: "PING",
        DOWNLOAD: "DOWNLOAD",
        UPLOAD: "UPLOAD",
        DONE: "DONE",
        ABORTED: "ABORTED",
      });

      let state = State.IDLE;

      let cur = {
        ping: null,
        jitter: null,
        loss: null,
        down: 0,
        up: 0,
        display: 0,
        needleDeg: 140,
      };

      let raf = 0;
      let phaseStart = 0;
      let runStart = 0;
      let aborted = false;

      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
      const ease = (x) => {
        x = clamp(x, 0, 1);
        return x * x * (3 - 2 * x);
      };
      const lerp = (a, b, t) => a + (b - a) * t;

      const fmt1 = (v) => (Math.round(v * 10) / 10).toFixed(1);
      const fmtIntFrac = (v) => {
        const fixed = fmt1(v);
        const [i, f] = fixed.split(".");
        return { i, f };
      };

      const setMainReadout = (v) => {
        const { i, f } = fmtIntFrac(v);
        ui.mainInt.textContent = i;
        ui.mainFrac.textContent = "." + f;
      };

      const setNeedleAngle = (deg) => {
        ui.needlePivot.style.transform = `rotate(${deg}deg)`;
      };

      const setPhase = (s) => {
        state = s;
        ui.phaseLabel.textContent = s;

        ui.statusText.textContent =
          s === State.IDLE ? "READY" :
          s === State.PING ? "PROBING" :
          s === State.DOWNLOAD ? "DOWNLINK" :
          s === State.UPLOAD ? "UPLINK" :
          s === State.DONE ? "COMPLETE" :
          s === State.ABORTED ? "ABORTED" : "ACTIVE";

        ui.heatLabel.textContent =
          s === State.IDLE ? "IDLE" :
          s === State.PING ? "WARMING" :
          s === State.DOWNLOAD ? "CRITICAL" :
          s === State.UPLOAD ? "CRITICAL" :
          s === State.DONE ? "COOLING" :
          s === State.ABORTED ? "CUT" : "ACTIVE";

        ui.pressureLabel.textContent =
          s === State.IDLE ? "STABLE" :
          s === State.PING ? "RISING" :
          s === State.DOWNLOAD ? "OVERLOAD" :
          s === State.UPLOAD ? "OVERLOAD" :
          s === State.DONE ? "VENTING" :
          s === State.ABORTED ? "DUMPED" : "ACTIVE";

        const scanning = (s === State.PING || s === State.DOWNLOAD || s === State.UPLOAD);
        ui.scanJitter.style.opacity = scanning ? "1" : "0";
        ui.scanJitter.style.animation = scanning ? "jitter 0.5s infinite" : "none";

        ui.aura.style.opacity = scanning ? "0.55" : "0.35";
        ui.aura.style.filter = scanning ? "blur(36px)" : "blur(28px)";
      };

      const lockButtons = (locked) => {
        ui.btnStart.disabled = locked;
        ui.btnAbort.disabled = !locked;
        ui.btnReset.disabled = locked;
      };

      const mmss = (ms) => {
        const s = Math.floor(ms / 1000);
        const m = Math.floor(s / 60);
        const r = s % 60;
        return String(m).padStart(2, "0") + ":" + String(r).padStart(2, "0");
      };

      const resetUI = () => {
        aborted = false;
        setPhase(State.IDLE);
        lockButtons(false);

        cur.ping = null;
        cur.jitter = null;
        cur.loss = null;
        cur.down = 0;
        cur.up = 0;
        cur.display = 0;
        cur.needleDeg = 140;

        ui.latencyVal.textContent = "--";
        ui.jitterVal.textContent = "--";
        ui.lossVal.textContent = "--";
        ui.downVal.textContent = "0.0";
        ui.upVal.textContent = "0.0";

        ui.unitLabel.textContent = "Mbps";
        ui.timerText.textContent = "00:00";

        setMainReadout(0);
        setNeedleAngle(cur.needleDeg);

        ui.wavePath.setAttribute("d", "M0 100 L20 40 L40 80 L60 20 L80 90 L100 10 L120 70 L140 30 L160 85 L180 45 L200 100 Z");
      };

      const rand = (a, b) => a + Math.random() * (b - a);

      const profile = {
        pingMs: () => Math.round(rand(8, 22)),
        jitterMs: () => Math.round(rand(1, 6)),
        lossPct: () => Math.round(rand(0, 2) * 10) / 10,
        downPeak: () => rand(650, 980),
        upPeak: () => rand(70, 180),
      };

      const needleForMbps = (mbps) => {
        const max = 1000;
        const t = clamp(mbps / max, 0, 1);
        return lerp(50, 320, ease(t));
      };

      const updateWaveform = (timeMs, intensity01) => {
        const wob = (i) => Math.sin((timeMs / 140) + i) * (12 + 22 * intensity01);
        const base = [
          [0,100],[20,40],[40,80],[60,20],[80,90],[100,10],[120,70],[140,30],[160,85],[180,45],[200,100]
        ];
        const pts = base.map(([x,y], idx) => {
          const dy = wob(idx * 0.9) * (idx % 2 === 0 ? 0.35 : 0.55);
          const ny = clamp(y + dy, 4, 98);
          return [x, ny];
        });
        const d = "M" + pts.map(([x,y]) => `${x} ${y.toFixed(1)}`).join(" L ") + " Z";
        ui.wavePath.setAttribute("d", d);
      };

      const PING_DUR = 1200;
      const DOWN_DUR = 5200;
      const UP_DUR = 3800;

      let downPeak = 0;
      let upPeak = 0;

      const startRun = () => {
        if (state !== State.IDLE && state !== State.DONE && state !== State.ABORTED) return;

        aborted = false;
        lockButtons(true);

        runStart = performance.now();
        phaseStart = runStart;
        setPhase(State.PING);

        cur.ping = profile.pingMs();
        cur.jitter = profile.jitterMs();
        cur.loss = profile.lossPct();

        ui.latencyVal.textContent = String(cur.ping);
        ui.jitterVal.textContent = String(cur.jitter);
        ui.lossVal.textContent = String(cur.loss);

        cur.display = 0;
        setMainReadout(cur.display);
        setNeedleAngle(needleForMbps(0));

        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(tick);
      };

      const abortRun = () => {
        if (state === State.IDLE || state === State.DONE || state === State.ABORTED) return;
        aborted = true;
        setPhase(State.ABORTED);
        lockButtons(false);

        ui.unitLabel.textContent = "Mbps";
        ui.statusText.textContent = "ABORTED";

        cancelAnimationFrame(raf);
      };

      const finishRun = () => {
        setPhase(State.DONE);
        lockButtons(false);
      };

      const tick = (now) => {
        if (aborted) return;

        const elapsed = now - runStart;
        ui.timerText.textContent = mmss(elapsed);

        const scanIntensity =
          (state === State.PING) ? 0.35 :
          (state === State.DOWNLOAD) ? 0.85 :
          (state === State.UPLOAD) ? 0.75 :
          0.25;

        updateWaveform(now, scanIntensity);

        if (state === State.PING) {
          const t = ease((now - phaseStart) / PING_DUR);
          ui.unitLabel.textContent = "ms";
          const shown = lerp(0, cur.ping ?? 12, t);
          cur.display = shown;
          setMainReadout(cur.display);

          const nd = lerp(needleForMbps(0), needleForMbps(120), t);
          setNeedleAngle(nd);

          if ((now - phaseStart) >= PING_DUR) {
            phaseStart = now;
            downPeak = profile.downPeak();
            ui.unitLabel.textContent = "Mbps";
            setPhase(State.DOWNLOAD);
          }
        }
        else if (state === State.DOWNLOAD) {
          const raw = (now - phaseStart) / DOWN_DUR;
          const t = ease(raw);

          const ramp = lerp(0, downPeak, t);
          const noise = Math.sin(now / 180) * (downPeak * 0.015) + Math.sin(now / 70) * (downPeak * 0.006);
          const val = clamp(ramp + noise, 0, downPeak * 1.02);

          cur.down = val;
          ui.downVal.textContent = fmt1(cur.down);

          cur.display = val;
          setMainReadout(cur.display);

          setNeedleAngle(needleForMbps(val));

          if (raw >= 1) {
            phaseStart = now;
            upPeak = profile.upPeak();
            setPhase(State.UPLOAD);
          }
        }
        else if (state === State.UPLOAD) {
          const raw = (now - phaseStart) / UP_DUR;
          const t = ease(raw);

          const ramp = lerp(0, upPeak, t);
          const noise = Math.sin(now / 200) * (upPeak * 0.03) + Math.sin(now / 90) * (upPeak * 0.01);
          const val = clamp(ramp + noise, 0, upPeak * 1.05);

          cur.up = val;
          ui.upVal.textContent = fmt1(cur.up);

          cur.display = val;
          setMainReadout(cur.display);

          setNeedleAngle(needleForMbps(val));

          if (raw >= 1) {
            ui.unitLabel.textContent = "Mbps";
            setMainReadout(cur.down);
            setNeedleAngle(needleForMbps(cur.down));

            finishRun();
            cancelAnimationFrame(raf);
            return;
          }
        }
        else {
          cancelAnimationFrame(raf);
          return;
        }

        raf = requestAnimationFrame(tick);
      };

      ui.btnStart.addEventListener("click", startRun);
      ui.btnAbort.addEventListener("click", abortRun);
      ui.btnReset.addEventListener("click", () => {
        cancelAnimationFrame(raf);
        resetUI();
      });

      $("btnSettings").addEventListener("click", () => {
        const overlay = document.querySelector(".vhs-overlay");
        const curOp = parseFloat(getComputedStyle(overlay).opacity || "0.30");
        overlay.style.opacity = (curOp < 0.35) ? "0.45" : "0.28";
      });

      // Bottom navigation binding and screen toggling
      const nav = {
        engine: document.getElementById("navEngine"),
        list: document.getElementById("navList"),
        map: document.getElementById("navMap"),
        config: document.getElementById("navConfig"),
      };
      const screens = {
        engine: document.getElementById("engineScreen"),
        list: document.getElementById("wifiListScreen"),
        map: document.getElementById("wifiMapScreen"),
        config: document.getElementById("configScreen"),
      };
      // Grab the decorative vertical bars so they can be hidden when switching screens
      const bars = {
        left: document.getElementById("barsLeft"),
        right: document.getElementById("barsRight"),
      };
      // Grab the map gauge value element to animate its number
      const mapValueEl = document.getElementById("mapValue");
      let mapAnimId = null;
      /**
       * Starts the animation loop for the map gauge. This animates the numeric
       * readout in the center of the map gauge by oscillating between 0 and 100.
       */
      function startMapAnimation() {
        if (mapAnimId) return;
        const startT = performance.now();
        const animate = (now) => {
          const elapsed = (now - startT) / 1000;
          // Oscillate value between 0 and 100 using a sine wave. Adjust frequency here.
          const value = (Math.sin(elapsed * 2) * 0.5 + 0.5) * 100;
          if (mapValueEl) mapValueEl.textContent = Math.round(value).toString();
          mapAnimId = requestAnimationFrame(animate);
        };
        mapAnimId = requestAnimationFrame(animate);
      }
      /**
       * Stops the map gauge animation if running.
       */
      function stopMapAnimation() {
        if (mapAnimId) {
          cancelAnimationFrame(mapAnimId);
          mapAnimId = null;
        }
      }
      function setActive(tab) {
        // Hide all screens
        Object.values(screens).forEach((s) => {
          if (s) s.classList.add("hidden");
        });
        // Show selected screen if exists
        if (screens[tab]) {
          screens[tab].classList.remove("hidden");
        }
        // Show or hide decorative bars based on active screen
        if (bars.left) bars.left.classList.toggle("hidden", tab !== "engine");
        if (bars.right) bars.right.classList.toggle("hidden", tab !== "engine");
        // Update nav colors
        Object.keys(nav).forEach((k) => {
          nav[k]?.classList.remove("text-ethereal-blue");
          nav[k]?.classList.add("text-slate-500");
        });
        if (nav[tab]) {
          nav[tab].classList.remove("text-slate-500");
          nav[tab].classList.add("text-ethereal-blue");
        }
        // Start or stop map animation depending on the active tab
        if (tab === "map") {
          startMapAnimation();
        } else {
          stopMapAnimation();
        }
      }
      // initial state: engine screen
      setActive("engine");
      // Event bindings
      nav.engine?.addEventListener("click", () => setActive("engine"));
      nav.list?.addEventListener("click", () => {
        setActive("list");
        ui.statusText.textContent = "WIFI";
        ui.scanJitter.style.opacity = "1";
        ui.scanJitter.style.animation = "jitter 0.35s linear 1";
        setTimeout(() => {
          ui.scanJitter.style.opacity = "0";
          ui.statusText.textContent = (state === State.IDLE ? "READY" : ui.statusText.textContent);
        }, 350);
        onListTabSelected();
      });
      nav.map?.addEventListener("click", () => {
        setActive("map");
        ui.statusText.textContent = "MAP";
        ui.scanJitter.style.opacity = "1";
        ui.scanJitter.style.animation = "jitter 0.35s linear 1";
        setTimeout(() => {
          ui.scanJitter.style.opacity = "0";
          ui.statusText.textContent = (state === State.IDLE ? "READY" : ui.statusText.textContent);
        }, 350);
      });
      nav.config?.addEventListener("click", () => {
        setActive("config");
        ui.statusText.textContent = "CONFIG";
        ui.scanJitter.style.opacity = "1";
        ui.scanJitter.style.animation = "jitter 0.35s linear 1";
        setTimeout(() => {
          ui.scanJitter.style.opacity = "0";
          ui.statusText.textContent = (state === State.IDLE ? "READY" : ui.statusText.textContent);
        }, 350);
      });

      const NATIVE_EVENT = "netninja:native";
      const cfgKey = "nn_cfg";
      const nativeBridge = {
        available() {
          return !!(window.NetNinjaBridge && typeof window.NetNinjaBridge.getBridgeState === "function");
        },
        call(method, ...args) {
          if (!this.available() || typeof window.NetNinjaBridge[method] !== "function") return null;
          try {
            return JSON.parse(window.NetNinjaBridge[method](...args));
          } catch {
            return null;
          }
        },
      };
      const runtime = {
        bridgeState: {
          available: nativeBridge.available(),
          enabled: false,
          canScan: false,
          scanPermissionGranted: false,
          locationServicesEnabled: false,
        },
        lastDeviceInfo: null,
        lastScanResults: [],
        lastScanSource: "demo",
      };
      const defaultConfig = () => ({
        autoScan: false,
        holoFX: false,
        alerts: false,
        demoMode: true,
        bridgeEnabled: false,
        neonIntensity: 70,
        scanSpeed: 50,
        accentMode: "blue",
        perfMode: "high",
      });
      const cfgCtrls = {
        autoScan: document.getElementById("cfgAutoScan"),
        holoFX: document.getElementById("cfgHoloFX"),
        alerts: document.getElementById("cfgAlerts"),
        demoMode: document.getElementById("cfgDemoMode"),
        bridgeEnabled: document.getElementById("cfgBridgeEnabled"),
        neonIntensity: document.getElementById("cfgNeonIntensity"),
        scanSpeed: document.getElementById("cfgScanSpeed"),
        accentMode: document.getElementById("cfgAccentMode"),
        perfMode: document.getElementById("cfgPerfMode"),
      };
      const cfgSaveBtn = document.getElementById("cfgSaveBtn");
      const cfgResetBtn = document.getElementById("cfgResetBtn");
      const cfgStatusMsg = document.getElementById("cfgStatusMsg");
      let cfgStatusTimer = 0;

      const escapeHtml = (value) => String(value ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll("\"", "&quot;")
        .replaceAll("'", "&#39;");

      const signalAccent = (level) => {
        if (level >= -50) return { color: "#00ff9d", glow: "rgba(0,255,157,0.4)" };
        if (level >= -65) return { color: "#00f3ff", glow: "rgba(0,243,255,0.4)" };
        if (level >= -75) return { color: "#ffaa00", glow: "rgba(255,170,0,0.4)" };
        return { color: "#a855f7", glow: "rgba(168,85,247,0.4)" };
      };

      const buildDemoResults = () => ([
        { ssid: "Neural Rig Alpha", bssid: "DE:MO:00:00:00:01", signalLevel: -42, frequency: 5805, capabilities: "[WPA3-SAE]", demo: true },
        { ssid: "Bio-Chip Cortex", bssid: "DE:MO:00:00:00:02", signalLevel: -56, frequency: 2412, capabilities: "[WPA2-PSK-CCMP][ESS]", demo: true },
        { ssid: "Ext. Data Core", bssid: "DE:MO:00:00:00:03", signalLevel: -71, frequency: 2462, capabilities: "[WPA2-PSK-CCMP][ESS]", demo: true },
        { ssid: "Holopad V9", bssid: "DE:MO:00:00:00:04", signalLevel: -81, frequency: 5200, capabilities: "[ESS]", demo: true },
      ]);

      const formatSecurity = (capabilities) => {
        const label = String(capabilities || "").trim();
        if (!label) return "OPEN";
        if (label.includes("WPA3")) return "WPA3";
        if (label.includes("WPA2")) return "WPA2";
        if (label.includes("WEP")) return "WEP";
        return label.replaceAll("[", "").replaceAll("]", "") || "SECURED";
      };

      function getCurrentConfig() {
        return {
          autoScan: cfgCtrls.autoScan.checked,
          holoFX: cfgCtrls.holoFX.checked,
          alerts: cfgCtrls.alerts.checked,
          demoMode: cfgCtrls.demoMode.checked,
          bridgeEnabled: cfgCtrls.bridgeEnabled.checked,
          neonIntensity: Number(cfgCtrls.neonIntensity.value),
          scanSpeed: Number(cfgCtrls.scanSpeed.value),
          accentMode: cfgCtrls.accentMode.value,
          perfMode: cfgCtrls.perfMode.value,
        };
      }

      function setConfigControls(data) {
        cfgCtrls.autoScan.checked = !!data.autoScan;
        cfgCtrls.holoFX.checked = !!data.holoFX;
        cfgCtrls.alerts.checked = !!data.alerts;
        cfgCtrls.demoMode.checked = !!data.demoMode;
        cfgCtrls.bridgeEnabled.checked = !!data.bridgeEnabled;
        cfgCtrls.neonIntensity.value = Number(data.neonIntensity);
        cfgCtrls.scanSpeed.value = Number(data.scanSpeed);
        cfgCtrls.accentMode.value = data.accentMode;
        cfgCtrls.perfMode.value = data.perfMode;
      }

      function showCfgStatus(message) {
        cfgStatusMsg.textContent = message;
        cfgStatusMsg.classList.remove("hidden");
        clearTimeout(cfgStatusTimer);
        cfgStatusTimer = setTimeout(() => cfgStatusMsg.classList.add("hidden"), 2400);
      }

      function updateBridgeUi() {
        const bridge = runtime.bridgeState;
        nativeUi.wifiBridgeState.textContent = !bridge.available ? "Unavailable" : bridge.enabled ? "Armed" : "Disabled";
        nativeUi.wifiPermissionState.textContent = !bridge.available ? "N/A" : !bridge.locationServicesEnabled ? "Location Services Off" : bridge.scanPermissionGranted ? "Granted" : "Tap Scan To Grant";
        nativeUi.wifiScanState.textContent = !bridge.canScan ? "Hardware Offline" : bridge.enabled ? "Ready" : "Standby";
        nativeUi.cfgBridgeSummary.textContent = !bridge.available
          ? "Native bridge unavailable in this shell."
          : bridge.enabled
            ? (bridge.scanPermissionGranted ? "Bridge enabled. Scan permissions ready." : "Bridge enabled. Scan will request permissions on tap.")
            : "Bridge loaded but disabled by config.";
      }

      function updateDeviceUi() {
        const info = runtime.lastDeviceInfo;
        nativeUi.cfgDeviceSummary.textContent = !info
          ? "No device snapshot yet."
          : `${info.manufacturer} ${info.model} / Android ${info.release} / SDK ${info.sdkInt}`;
      }

      function renderWifiNetworks(networks, source, meta) {
        runtime.lastScanResults = networks;
        runtime.lastScanSource = source;
        nativeUi.wifiScanMeta.textContent = meta;
        nativeUi.wifiEmptyState.classList.toggle("hidden", networks.length > 0);
        nativeUi.wifiDeviceList.innerHTML = networks.map((network, index) => {
          const accent = signalAccent(Number(network.signalLevel ?? -90));
          const pct = Math.max(12, Math.min(100, 120 + Number(network.signalLevel ?? -90)));
          const ssid = escapeHtml(network.ssid || `Hidden-${index + 1}`);
          const bssid = escapeHtml(network.bssid || "N/A");
          const level = escapeHtml(`${network.signalLevel ?? "--"} dBm`);
          const freq = escapeHtml(network.frequency ? `${network.frequency} MHz` : "Unknown band");
          const security = escapeHtml(formatSecurity(network.capabilities));
          const badge = source === "demo" ? "DEMO" : "LIVE";
          return `
            <div class="shard-card p-5 group" style="--edge-color:${accent.color}; --glow-color:${accent.glow};">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 flex items-center justify-center rounded-xl border border-white/10" style="box-shadow:0 0 18px ${accent.glow};">
                  <span class="material-symbols-outlined" style="color:${accent.color};">wifi</span>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between gap-3">
                    <div class="min-w-0">
                      <h3 class="text-lg uppercase tracking-wider truncate" style="font-family:'Orbitron', sans-serif; color:#ffffff;">${ssid}</h3>
                      <p class="text-[10px] uppercase tracking-[0.28em] text-slate-400 mt-1">${bssid}</p>
                    </div>
                    <span class="text-[9px] font-black tracking-[0.3em] px-2 py-1 rounded-full border" style="color:${accent.color}; border-color:${accent.color};">${badge}</span>
                  </div>
                  <div class="mt-3 relative h-4 w-full liquid-bar-container">
                    <div class="liquid-bar-fill" style="width:${pct}%; --bar-start:${accent.color}; --bar-mid:${accent.color}; --bar-end:#ffffff;"></div>
                  </div>
                  <div class="flex flex-wrap justify-between gap-2 mt-3 text-[10px] font-bold tracking-widest">
                    <span class="text-gray-400">${freq}</span>
                    <span style="color:${accent.color}; text-shadow:0 0 5px ${accent.glow};">${level} // ${security}</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join("");
      }

      function renderDemoFallback(reason) {
        renderWifiNetworks(buildDemoResults(), "demo", reason);
        nativeUi.wifiScanState.textContent = "Demo Fallback";
      }

      function syncBridgeState(pushConfigToggle) {
        const bridgeState = nativeBridge.call("getBridgeState");
        runtime.bridgeState = bridgeState || runtime.bridgeState;
        if (pushConfigToggle && bridgeState) {
          cfgCtrls.bridgeEnabled.checked = !!bridgeState.enabled;
        }
        updateBridgeUi();
      }

      function refreshDeviceInfo() {
        const result = nativeBridge.call("getDeviceInfo");
        if (result?.ok && result.deviceInfo) {
          runtime.lastDeviceInfo = result.deviceInfo;
          updateDeviceUi();
          return true;
        }
        runtime.lastDeviceInfo = null;
        updateDeviceUi();
        return false;
      }

      function loadConfig() {
        const raw = localStorage.getItem(cfgKey);
        let data = defaultConfig();
        if (raw) {
          try {
            data = { ...data, ...JSON.parse(raw) };
          } catch {}
        }
        setConfigControls(data);
        applyPerfMode(cfgCtrls.perfMode.value);
      }

      function saveConfig() {
        const data = getCurrentConfig();
        localStorage.setItem(cfgKey, JSON.stringify(data));
        applyPerfMode(data.perfMode);
        if (nativeBridge.available()) {
          const bridgeState = nativeBridge.call("setBridgeEnabled", !!data.bridgeEnabled);
          if (bridgeState) {
            runtime.bridgeState = bridgeState;
          }
        }
        syncBridgeState(false);
        if (runtime.bridgeState.enabled) {
          refreshDeviceInfo();
        } else {
          runtime.lastDeviceInfo = null;
          updateDeviceUi();
        }
        if (cfgCtrls.demoMode.checked && runtime.lastScanSource !== "real") {
          renderDemoFallback("Demo feed armed");
        }
        showCfgStatus("Settings saved.");
      }

      function resetConfig() {
        localStorage.removeItem(cfgKey);
        const defaults = defaultConfig();
        setConfigControls(defaults);
        applyPerfMode(defaults.perfMode);
        if (nativeBridge.available()) {
          const bridgeState = nativeBridge.call("setBridgeEnabled", false);
          if (bridgeState) {
            runtime.bridgeState = bridgeState;
          }
        }
        runtime.lastDeviceInfo = null;
        updateDeviceUi();
        syncBridgeState(false);
        renderDemoFallback("Demo feed armed");
        showCfgStatus("Settings reset.");
      }

      function applyPerfMode(mode) {
        const overlay = document.querySelector(".vhs-overlay");
        const buttons = document.querySelectorAll(".cybr-btn");
        if (mode === "low") {
          overlay.style.opacity = "0.15";
          buttons.forEach(btn => {
            btn.classList.remove("tap-glow");
            btn.classList.add("tap-glow-low");
          });
        } else {
          overlay.style.opacity = "0.30";
          buttons.forEach(btn => {
            btn.classList.remove("tap-glow-low");
            btn.classList.add("tap-glow");
          });
        }
      }

      function exportDiagnostics() {
        syncBridgeState(false);
        if (!runtime.bridgeState.available || !runtime.bridgeState.enabled) {
          showCfgStatus("Enable Native Bridge before exporting diagnostics.");
          return;
        }
        const payload = {
          capturedAt: new Date().toISOString(),
          config: getCurrentConfig(),
          lastScan: {
            source: runtime.lastScanSource,
            count: runtime.lastScanResults.length,
            results: runtime.lastScanResults,
          },
          engine: {
            state,
            latency: ui.latencyVal.textContent,
            jitter: ui.jitterVal.textContent,
            loss: ui.lossVal.textContent,
            down: ui.downVal.textContent,
            up: ui.upVal.textContent,
          },
        };
        const result = nativeBridge.call("exportDiagnostics", JSON.stringify(payload));
        if (result?.ok === false) {
          showCfgStatus(result.message || "Diagnostics export failed.");
        } else {
          nativeUi.wifiScanState.textContent = "Export Requested";
        }
      }

      function requestNativeWifiScan(userInitiated) {
        syncBridgeState(false);
        if (!runtime.bridgeState.available || !runtime.bridgeState.enabled) {
          if (cfgCtrls.demoMode.checked) {
            renderDemoFallback("Bridge offline. Demo fallback active.");
          } else if (userInitiated) {
            showCfgStatus("Enable Native Bridge or Demo Mode first.");
          }
          return;
        }
        if (!userInitiated && !runtime.bridgeState.scanPermissionGranted) {
          nativeUi.wifiScanState.textContent = "Tap Scan To Grant";
          nativeUi.wifiScanMeta.textContent = "Auto scan paused until permissions are granted";
          return;
        }
        const result = nativeBridge.call("requestWifiScan");
        if (result?.ok === false) {
          nativeUi.wifiScanState.textContent = result.code || "Error";
          if (cfgCtrls.demoMode.checked) {
            renderDemoFallback("Live scan unavailable. Demo fallback active.");
          } else if (userInitiated) {
            showCfgStatus(result.message || "Wi-Fi scan failed.");
          }
        } else if (result?.status === "permission_requested") {
          nativeUi.wifiScanState.textContent = "Permission Requested";
          nativeUi.wifiScanMeta.textContent = "Grant permissions to continue live scanning";
        } else {
          nativeUi.wifiScanState.textContent = "Scanning";
          nativeUi.wifiScanMeta.textContent = "Native scan request sent to Android";
        }
      }

      function handleNativeEvent(event) {
        const detail = event.detail || {};
        const payload = detail.payload || {};
        if (detail.type === "bridge_state") {
          runtime.bridgeState = payload;
          updateBridgeUi();
          if (payload.enabled) {
            refreshDeviceInfo();
          }
          return;
        }
        if (detail.type === "wifi_scan_results") {
          const results = Array.isArray(payload.results) ? payload.results : [];
          if (results.length > 0) {
            renderWifiNetworks(results, payload.source || "real", `${payload.count || results.length} networks captured`);
            nativeUi.wifiScanState.textContent = payload.source === "cached" ? "Cached Results" : "Live Results";
          } else if (cfgCtrls.demoMode.checked) {
            renderDemoFallback("No live networks returned. Demo fallback active.");
          } else {
            renderWifiNetworks([], payload.source || "real", "No nearby networks found");
            nativeUi.wifiScanState.textContent = "No Results";
          }
          return;
        }
        if (detail.type === "scan_status") {
          const status = payload.status || "idle";
          nativeUi.wifiScanState.textContent = status.replaceAll("_", " ").toUpperCase();
          if (payload.message) {
            nativeUi.wifiScanMeta.textContent = payload.message;
          }
          if ((status === "permission_denied" || status === "wifi_unavailable" || status === "location_services_disabled" || status === "error") && cfgCtrls.demoMode.checked) {
            renderDemoFallback("Live scan interrupted. Demo fallback active.");
          }
          return;
        }
        if (detail.type === "export_status") {
          if (payload.status === "saved") showCfgStatus("Diagnostics exported.");
          else if (payload.status === "cancelled") showCfgStatus("Diagnostics export cancelled.");
          else if (payload.status === "error") showCfgStatus(payload.message || "Diagnostics export failed.");
        }
      }

      function onListTabSelected() {
        syncBridgeState(false);
        if (cfgCtrls.autoScan.checked && runtime.bridgeState.enabled && runtime.bridgeState.scanPermissionGranted) {
          requestNativeWifiScan(false);
          return;
        }
        if (runtime.lastScanResults.length === 0 || (cfgCtrls.demoMode.checked && runtime.lastScanSource !== "real")) {
          renderDemoFallback("Demo feed armed");
        }
      }

      window.addEventListener(NATIVE_EVENT, handleNativeEvent);
      cfgSaveBtn?.addEventListener("click", saveConfig);
      cfgResetBtn?.addEventListener("click", resetConfig);
      nativeUi.wifiScanBtn?.addEventListener("click", () => requestNativeWifiScan(true));
      nativeUi.wifiDemoBtn?.addEventListener("click", () => renderDemoFallback("Manual demo override"));
      nativeUi.wifiExportBtn?.addEventListener("click", exportDiagnostics);
      nativeUi.cfgRefreshDeviceBtn?.addEventListener("click", () => {
        syncBridgeState(false);
        if (!runtime.bridgeState.enabled) {
          showCfgStatus("Enable Native Bridge before requesting device info.");
          return;
        }
        if (refreshDeviceInfo()) showCfgStatus("Device snapshot refreshed.");
        else showCfgStatus("Device snapshot unavailable.");
      });
      nativeUi.cfgExportDiagBtn?.addEventListener("click", exportDiagnostics);
      loadConfig();
      syncBridgeState(true);
      updateDeviceUi();
      renderDemoFallback("Demo feed armed");
      resetUI();
    })();
  </script>
</body>
</html>
